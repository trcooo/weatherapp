{% extends "base.html" %}
{% block title %}Weather — Modern{% endblock %}
{% block head_extra %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
{% endblock %}

{% block topbar_right %}
<form class="search" id="searchForm" autocomplete="off" aria-label="Поиск города">
  <span class="search__icon" aria-hidden="true">
    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M10.5 18.5C14.9183 18.5 18.5 14.9183 18.5 10.5C18.5 6.08172 14.9183 2.5 10.5 2.5C6.08172 2.5 2.5 6.08172 2.5 10.5C2.5 14.9183 6.08172 18.5 10.5 18.5Z" stroke="currentColor" stroke-width="1.8"/>
      <path d="M16.6 16.6L21 21" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
    </svg>
  </span>
  <input class="search__input" id="cityInput" name="city" placeholder="Введите город…" inputmode="search" />
  <button class="search__btn" type="submit">Показать</button>
</form>
{% endblock %}

{% block content %}
<section class="grid">
      <section class="card hero" id="heroCard">
        <div class="hero__head">
          <div>
            <div class="kicker">Сейчас</div>
            <h1 class="hero__title" id="place">—</h1>
            <div class="hero__desc" id="desc">—</div>
          </div>
          <div class="hero__icon" id="iconWrap" aria-hidden="true"></div>
        </div>

        <div class="hero__temp">
          <div class="temp" id="temp">—</div>
          <div class="temp__meta">
            <div id="feels">—</div>
            <div class="badge" id="updated">—</div>
          </div>
        </div>

        <div class="stats">
          <div class="stat">
            <div class="stat__label">Влажность</div>
            <div class="stat__value" id="humidity">—</div>
          </div>
          <div class="stat">
            <div class="stat__label">Ветер</div>
            <div class="stat__value" id="wind">—</div>
          </div>
          <div class="stat">
            <div class="stat__label">Давление</div>
            <div class="stat__value" id="pressure">—</div>
          </div>
          <div class="stat">
            <div class="stat__label">Облачность</div>
            <div class="stat__value" id="clouds">—</div>
          </div>
        </div>

        <div class="sun">
          <div class="sun__item">
            <div class="sun__label">Восход</div>
            <div class="sun__value" id="sunrise">—</div>
          </div>
          <div class="sun__divider" aria-hidden="true"></div>
          <div class="sun__item">
            <div class="sun__label">Закат</div>
            <div class="sun__value" id="sunset">—</div>
          </div>
        </div>

        <div class="error" id="error" hidden></div>
      </section>

      <section class="card" aria-label="Прогноз">
        <div class="card__head">
          <div>
            <div class="kicker">Дальше</div>
            <h2 class="card__title">Прогноз на ~48 часов</h2>
          </div>
          <div class="chip" id="unitsChip">—</div>
        </div>

        <div class="forecast" id="forecast">
          <div class="forecast__empty" id="forecastEmpty">Введите город, чтобы увидеть прогноз</div>
        </div>
      </section>

      <section class="card map" aria-label="Карта">
        <div class="card__head">
          <div>
            <div class="kicker">Карта</div>
            <h2 class="card__title">Местоположение</h2>
          </div>
          <a class="chip chip--link" id="mapLink" href="#" target="_blank" rel="noreferrer">Открыть</a>
        </div>

        <div id="map" class="map__canvas" role="application" aria-label="Карта города"></div>
        <div class="map__meta muted" id="mapMeta">—</div>
      </section>
      <section class="card tips" aria-label="Подсказки">
        <h2 class="card__title">Быстрые подсказки</h2>
        <div class="tips__grid">
          
          {% if current_user.is_authenticated and current_user.favorites %}
            {% for f in current_user.favorites %}
              <button class="pill" data-city="{{ f.city }}">{{ f.city }}</button>
            {% endfor %}
            <span class="tips__sep" aria-hidden="true"></span>
          {% endif %}
          <button class="pill" data-city="Москва">Москва</button>
          <button class="pill" data-city="Санкт-Петербург">Санкт‑Петербург</button>
          <button class="pill" data-city="Казань">Казань</button>
          <button class="pill" data-city="Новосибирск">Новосибирск</button>
          <button class="pill" data-city="Екатеринбург">Екатеринбург</button>
          <button class="pill" data-city="Сочи">Сочи</button>
        
        </div>
        <p class="muted">
          Данные: OpenWeather. Время восхода/заката отображается в UTC (как приходит из API).
        </p>
      </section>
    </section>
{% endblock %}

{% block scripts %}
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
<script src="/static/js/app.js?v={{ build_id }}"></script>
{% endblock %}
