<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>{% block title %}Weather{% endblock %}</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/static/css/styles.css" />
  {% block head_extra %}{% endblock %}
  <meta name="theme-color" content="#3BA7FF" />
</head>
<body>
  <div class="bg">
    <div class="blob blob--a"></div>
    <div class="blob blob--b"></div>
    <div class="blob blob--c"></div>
  </div>

  <main class="app" aria-live="polite">
    <header class="topbar">
      <a class="brand" href="/" aria-label="На главную">
        <div class="brand__logo" aria-hidden="true">
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M7 15.5C4.79086 15.5 3 13.7091 3 11.5C3 9.79086 4.07669 8.33663 5.58999 7.78024C6.06336 5.46673 8.10762 3.75 10.5 3.75C13.1234 3.75 15.3016 5.79111 15.4799 8.41069C15.8121 8.30203 16.1659 8.25 16.5312 8.25C18.5908 8.25 20.25 9.90917 20.25 11.9688C20.25 14.0283 18.5908 15.6875 16.5312 15.6875H7" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
            <path d="M9 18.5H15" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
          </svg>
        </div>
        <div class="brand__text">
          <div class="brand__name">Weather</div>
          <div class="brand__tag">современный прогноз</div>
        </div>
      </a>

      {% block topbar_right %}{% endblock %}

      <div class="account">
        {% if current_user.is_authenticated %}
          <a class="account__btn" href="{{ url_for('profile') }}" title="Профиль">
            <span class="avatar" aria-hidden="true">{{ (current_user.username[:1] or "U")|upper }}</span>
            <span class="account__name">{{ current_user.username }}</span>
          </a>
          <a class="account__link" href="{{ url_for('auth.logout') }}">Выйти</a>
        {% else %}
          <a class="account__link" href="{{ url_for('auth.login') }}">Войти</a>
          <a class="account__btn account__btn--primary" href="{{ url_for('auth.register') }}">Регистрация</a>
        {% endif %}
      </div>
    </header>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="toasts" role="status" aria-live="polite">
          {% for cat, msg in messages %}
            <div class="toast toast--{{ cat }}">{{ msg }}</div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    {% block content %}{% endblock %}

    <footer class="footer">
      <div>© <span id="year"></span> Weather</div>
    </footer>
  </main>

  <script>
    window.__USER_PREFS__ = {{ user_prefs|default(None)|tojson }};
  </script>
  <script src="/static/js/app_base.js"></script>
  {% block scripts %}{% endblock %}
</body>
</html>
